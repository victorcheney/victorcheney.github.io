<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>错误监控收集--Sentry入门 | VICTORCHENEY | INNERPEACE</title>

  
  <meta name="author" content="victor cheney">
  

  
  <meta name="description" content="Sentry监控入门Docker内部部署：https://docs.sentry.io/server/installation/docker/https://docs.sentry.io/server/
官方docker运行Sentry引导程序onpremise
参考：前端异常监控之 Sentry的部署和使用搭建私有的前端监控服务: sentrysentry使用实践
Sentry环境Docker安装要求：  
12Docker 1.10.0+  Compose 1.6.0+ (optional)">
  

  
  
  <meta name="keywords" content="错误监控收集">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="错误监控收集--Sentry入门">

  <meta property="og:site_name" content="VICTORCHENEY">

  
  <meta property="og:image" content="/favicon.ico">
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="VICTORCHENEY" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">VICTORCHENEY</a>
    </h1>
    <p class="site-description">INNERPEACE</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives">归档</a></li>
      
        <li><a href="/categories">分类</a></li>
      
        <li><a href="/tags">标签</a></li>
      
        <li><a href="/about">关于</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>错误监控收集--Sentry入门</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/12/15/错误监控收集-Sentry入门/" rel="bookmark">
        <time class="entry-date published" datetime="2018-12-15T10:43:59.000Z">
          2018-12-15
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="Sentry监控入门"><a href="#Sentry监控入门" class="headerlink" title="Sentry监控入门"></a>Sentry监控入门</h1><h2 id="Docker内部部署："><a href="#Docker内部部署：" class="headerlink" title="Docker内部部署："></a>Docker内部部署：</h2><p><a href="https://docs.sentry.io/server/installation/docker/" target="_blank" rel="noopener">https://docs.sentry.io/server/installation/docker/</a><br><a href="https://docs.sentry.io/server/" target="_blank" rel="noopener">https://docs.sentry.io/server/</a></p>
<p>官方docker运行Sentry引导程序<a href="https://github.com/getsentry/onpremise" target="_blank" rel="noopener">onpremise</a></p>
<p>参考：<br><a href="https://juejin.im/post/5b55c33ae51d45198f5c7a91" target="_blank" rel="noopener">前端异常监控之 Sentry的部署和使用</a><br><a href="https://juejin.im/post/5b226cbe51882574d02f9f62" target="_blank" rel="noopener">搭建私有的前端监控服务: sentry</a><br><a href="https://www.jianshu.com/p/66e00077fac3" target="_blank" rel="noopener">sentry使用实践</a></p>
<h3 id="Sentry环境"><a href="#Sentry环境" class="headerlink" title="Sentry环境"></a>Sentry环境</h3><p>Docker安装要求：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Docker 1.10.0+  </span><br><span class="line">Compose 1.6.0+ (optional)</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>安装环境</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ubuntu 16.04.2</span><br><span class="line">phthon 2.7.15</span><br><span class="line">Sentry 9.0.0</span><br><span class="line">Docker version 18.06.1-ce</span><br><span class="line">docker-compose version 1.23.2</span><br></pre></td></tr></table></figure>
<h3 id="配置SSL"><a href="#配置SSL" class="headerlink" title="配置SSL"></a>配置SSL</h3><p>使用Nginx转发</p>
<h3 id="配置邮件系统"><a href="#配置邮件系统" class="headerlink" title="配置邮件系统"></a>配置邮件系统</h3><p>1、修改<code>config.yml</code>配置文件</p>
<p><img src="sentry-mail.png" alt="sentry-mail.png"></p>
<p>2、修改<code>docker-compose.yml</code>文件</p>
<p><img src="sentry-mail-1.png" alt="sentry-mail-1.png"></p>
<p>然后重启镜像</p>
<pre><code>sudo docker-compose stop    // 停止镜像
sudo docker-compose up -d    // 运行镜像
</code></pre><h2 id="使用文档"><a href="#使用文档" class="headerlink" title="使用文档"></a>使用文档</h2><p>Node.js <a href="https://docs.sentry.io/clients/node/usage/" target="_blank" rel="noopener">https://docs.sentry.io/clients/node/usage/</a></p>
<p>Android <a href="https://docs.sentry.io/clients/java/modules/android/" target="_blank" rel="noopener">https://docs.sentry.io/clients/java/modules/android/</a></p>
<p>angularjs <a href="https://docs.sentry.io/clients/javascript/integrations/angularjs/" target="_blank" rel="noopener">https://docs.sentry.io/clients/javascript/integrations/angularjs/</a></p>
<p>Java <a href="https://docs.sentry.io/clients/java/migration/" target="_blank" rel="noopener">https://docs.sentry.io/clients/java/migration/</a></p>
<h2 id="使用Sentry-cli-上传sourcemap-https-docs-sentry-io-cli-configuration"><a href="#使用Sentry-cli-上传sourcemap-https-docs-sentry-io-cli-configuration" class="headerlink" title="使用Sentry-cli 上传sourcemap https://docs.sentry.io/cli/configuration/"></a>使用Sentry-cli 上传sourcemap <a href="https://docs.sentry.io/cli/configuration/" target="_blank" rel="noopener">https://docs.sentry.io/cli/configuration/</a></h2><h3 id="创建令牌"><a href="#创建令牌" class="headerlink" title="创建令牌"></a>创建令牌</h3><p><img src="createAuthToken.png" alt="createAuthToken.png"></p>
<h3 id="安装Sentry-CLI"><a href="#安装Sentry-CLI" class="headerlink" title="安装Sentry-CLI"></a>安装Sentry-CLI</h3><p>官方文档：<a href="https://docs.sentry.io/cli/installation/" target="_blank" rel="noopener">https://docs.sentry.io/cli/installation/</a></p>
<p>使用npm安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @sentry/cli</span><br></pre></td></tr></table></figure>
<p>安装完成查看版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sentry-cli -V</span><br><span class="line"></span><br><span class="line">注：V是大写的 [sentry-cli --help] 命令查看更多命令，此处使用的是 [sentry-cli 1.37.1]</span><br></pre></td></tr></table></figure>
<h3 id="配置和身份验证"><a href="#配置和身份验证" class="headerlink" title="配置和身份验证"></a>配置和身份验证</h3><p>对于大多数功能需要进行身份验证，通过<code>sentry-cli</code> 的login命令来完成，默认情况下，连接到的是Sentry的SaaS平台地址<code>sentry.io</code>,这里使用本地搭建的服务地址：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sentry login // 默认命令，url是 sentry.io</span><br></pre></td></tr></table></figure>
<p>添加 <code>--url</code> 参数配置sentry登录服务器地址：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sentry --url https://www.xxxx.com login</span><br></pre></td></tr></table></figure>
<p>根据提示，如果已经生成了token，根据提示输入token即可</p>
<p><img src="sentrycli-login.png" alt="sentrycli-login.png"></p>
<p><code>.sentryclirc</code> 文件为生成的配置文件，设置了server地址和token</p>
<h3 id="发布管理-https-docs-sentry-io-cli-releases-creating-deploys"><a href="#发布管理-https-docs-sentry-io-cli-releases-creating-deploys" class="headerlink" title="发布管理 https://docs.sentry.io/cli/releases/#creating-deploys"></a>发布管理 <a href="">https://docs.sentry.io/cli/releases/#creating-deploys</a></h3><h4 id="创建版本"><a href="#创建版本" class="headerlink" title="创建版本"></a>创建版本</h4><p>创建一个release</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sentry-cli releases -o [组织名称] -p [项目名称] new [release名称]</span><br></pre></td></tr></table></figure>
<p>本地应用，在Raven的config中添加对应的release，指定版本后，每次上报到会分类到该版本下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Raven.config(&apos;https://2514ce9dc9d841c9922347233a71beaa@www.fmbiz.com.cn:9001/2&apos;，&#123;</span><br><span class="line">    release: &apos;staging@1.0.1&apos; // staging@1.0.1即为上一步创建的 release名称</span><br><span class="line">&#125;).install()</span><br></pre></td></tr></table></figure>
<p>删除release命令:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sentry-cli releases -o [组织名称] -p [项目名称] delete [release名称]</span><br></pre></td></tr></table></figure>
<pre><code>注：删除某个release时需要将其下的异常处理掉,并将该版本的sourcemap文件清空,完成上面两步可能还要等待2小时才能删除，不然会报错：该版本还有其它依赖。
</code></pre><p>示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sentry-cli releases -o fanmi -p fmbiz-web new fmbiz@3.5.0</span><br></pre></td></tr></table></figure>
<p>成功的输出信息：<code>Created release fmbiz@3.5.0.</code></p>
<p>Raven配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Raven.config(&apos;https://2514ce9dc9d841c9922347233a71beaa@www.fmbiz.com.cn:9001/2&apos;，&#123;</span><br><span class="line">    release: &apos;fmbiz@3.5.0&apos;</span><br><span class="line">&#125;).install()</span><br></pre></td></tr></table></figure>
<h4 id="sourceMap管理"><a href="#sourceMap管理" class="headerlink" title="sourceMap管理"></a>sourceMap管理</h4><p>上传SourceMap</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sentry-cli releases -o [组织] -p [项目] files [staging@1.0.1] upload-sourcemaps [map文件所在目录] --url-prefix [线上资源URI]</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sentry-cli releases -o fanmi -p fmbiz-web files fmbiz@3.5.0 upload-sourcemaps test/sourcemaps --url-prefix &apos;~/&apos;</span><br><span class="line"></span><br><span class="line">如果报413错误，配置nginx.conf在http中加上</span><br><span class="line">client_max_body_size 50m;</span><br></pre></td></tr></table></figure>
<p>删除SourceMap：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sentry-cli releases -o [组织] -p [项目] files staging@1.0.1 delete --all</span><br></pre></td></tr></table></figure>
<p>参考：</p>
<p><a href="https://docs.sentry.io/workflow/releases/?platform=javascript#create-deploy" target="_blank" rel="noopener">https://docs.sentry.io/workflow/releases/?platform=javascript#create-deploy</a></p>
<p><a href="https://docs.sentry.io/cli/releases/#upload-files" target="_blank" rel="noopener">https://docs.sentry.io/cli/releases/#upload-files</a></p>
<p><a href="https://segmentfault.com/a/1190000014683598#articleHeader1" target="_blank" rel="noopener">https://segmentfault.com/a/1190000014683598#articleHeader1</a></p>
<p><a href="https://segmentfault.com/a/1190000012051620" target="_blank" rel="noopener">https://segmentfault.com/a/1190000012051620</a></p>
<p><a href="http://blog.51yip.com/server/1976.html" target="_blank" rel="noopener">http://blog.51yip.com/server/1976.html</a></p>
<p><a href="https://www.jianshu.com/p/66e00077fac3" target="_blank" rel="noopener">https://www.jianshu.com/p/66e00077fac3</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/错误监控收集/">错误监控收集</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/错误监控收集/">错误监控收集</a>
    </span>
    

    </div>

    
  </div>
</article>


    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    <br>
    
    &copy; 2019 victor cheney
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>